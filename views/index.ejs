<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Trophies</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    
    <nav id="main-nav" style="visibility: hidden;">
        <a href="/athletes" class="nav-link" data-bg="/images/background-landscape1.webp">For athletes</a>
        <a href="/organizers" class="nav-link" data-bg="/images/background-landscape2.webp">For organizers</a>
        <a href="/clubs" class="nav-link" data-bg="/images/background-landscape.webp">For clubs and stores</a>
    </nav>

    <div class="text-slogan">
        <p>Live.</p>
        <p>Feel it.</p>
        <p>Own the Moment.</p>
    </div>
    <div class="bottom-bar">
        <div>v.:0.0.1 &copy;
        <%= new Date().getFullYear() %> Sports Trophies</div>
    </div>

<script>
        document.addEventListener('DOMContentLoaded', () => {
            const nav = document.getElementById('main-nav');
            const links = document.querySelectorAll('.nav-link');
            const body = document.body;

            const imagesToPreload = [
                '/images/background-landscape1.webp',
                '/images/background-landscape2.webp',
                '/images/background-landscape.webp',
                '/images/background-portrait.webp' 
            ];
            
            let loadedCount = 0;
            imagesToPreload.forEach(src => {
                const img = new Image();
                img.onload = () => {
                    loadedCount++;
                    if (loadedCount === imagesToPreload.length) {
                        nav.style.visibility = 'visible';
                    }
                };
                img.src = src;
            });

            function changeBackground(link) {
                const newBgUrl = link.getAttribute('data-bg');
                body.style.backgroundImage = `url('${newBgUrl}')`;
                body.classList.add('fade-bg'); 
                links.forEach(l => l.classList.remove('active'));
                link.classList.add('active'); 
            }

            links.forEach(link => {
                const linkHref = link.getAttribute('href');
                
                // A) events for change background
                const backgroundSwitchHandler = (e) => {
                    if (link.classList.contains('active')) {
                        return;
                    }
                    if (e.type === 'touchstart') {
                        e.preventDefault(); 
                    }
                    
                    changeBackground(link);
                };
                
                link.addEventListener('mouseenter', backgroundSwitchHandler);
                link.addEventListener('touchstart', backgroundSwitchHandler, { passive: false });


                // B) ckick for navigation
                link.addEventListener('click', (e) => {
                    // Если ссылка уже активна (фон уже сменен), разрешаем стандартное действие (переход)
                    if (link.classList.contains('active')) {
                        // Разрешаем переход
                        return true; 
                    } else {
                        // Если это первый клик/тач, предотвращаем переход, но меняем фон
                        e.preventDefault();
                        changeBackground(link);
                    }
                });
                
            });
            
            let defaultBgUrl = '/images/background-landscape1.webp';
            
            if (window.matchMedia("(orientation: landscape)").matches) {
                body.style.backgroundImage = `url('${defaultBgUrl}')`;
                const defaultLink = document.querySelector(`[data-bg="${defaultBgUrl}"]`);
                if (defaultLink) {
                    defaultLink.classList.add('active');
                }
            }
        });
    </script>
</body>
</html>